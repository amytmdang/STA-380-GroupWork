---
title: "HW1 Bootstrapping"
author: "Abraham Khan"
date: "August 8, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Bootstrapping

```{r libraries, echo=FALSE, message=FALSE, warning=FALSE}
library(kableExtra)
library(ggplot2)
library(mosaic)
library(quantmod)
library(foreach)
```



```{r Asset Classes, echo=FALSE, message=FALSE, warning=FALSE}
# Import assets
mystocks = c("SPY", "TLT", "LQD", "EEM", "VNQ")
getSymbols(mystocks)

# Adjust for splits and dividends
SPYa = adjustOHLC(SPY)
TLTa = adjustOHLC(TLT)
LQDa = adjustOHLC(LQD)
EEMa = adjustOHLC(EEM)
VNQa = adjustOHLC(VNQ)

# Combine all the returns in a matrix
all_returns = cbind(	ClCl(SPYa),
                     ClCl(TLTa),
                     ClCl(LQDa),
                     ClCl(EEMa),
                     ClCl(VNQa))
all_returns = as.matrix(na.omit(all_returns))

risk = matrix(0,nrow=2,ncol = 5)
colnames(risk) = mystocks
rownames(risk) = c('Average Annual Return', 'Annualized Standard Deviation')

#Returns
for(c in 1:5){
  risk[1,c] = ((1+mean(all_returns[,c]))^252-1)*100
}

#Standard Deviations
for(c in 1:5){
  risk[2,c] = (sd(all_returns[,c]))*sqrt(252)*100
}

kable(as.table(risk)) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

simulations = matrix(0,nrow=2,ncol=3)
colnames(simulations) = c('Equal Weights', 'Safe', 'Aggressive')
rownames(simulations) = c('Value in 4 Weeks', '5% Value at Risk')


```

The above table shows the annualized returns and standard deviation in returns of our five assets. Using these metrics as proxies for return and risk, respectively, we can their general characteristics. SPY commonly represents "the market" by indexing the US's 500 largest stocks. Over the last eight and a half years it has returned 10% on average, but had a standard deviation of almost 20% due to sharp rises an falls. TLT and LQD are fixed income securities that offer lower returns, but much more consistent returns. Between them, the corporate bonds (LQD) show lower risk and returns, likely because the security is diversified across companies while TLT is 100% tied to the US government. In contrast, EEM represents emerging market stocks which have high potential gains, but also extremely high volatility. Lastly the real estate ETF (VNQ) returned roughly the same on average as the S&P, but with significantly higher volatility. This does not seem to follow the notion of higher risk is rewarded with higher returns......

The charts below show the simulated ending value of portolios made up of differing combinations of these five assets, starting with equal weights on each. The safer portolio is designed with the goal of reducing variance in returns and value at risk. It is invested 40% in TLT, 40% in LQD, 20% in SPY, and excludes the assets with the highest variance in returns. The aggressive portfolio attempts to meet the goal of increasing expected returns by investing 40% in SPY, 50% in EEM, 10% in VNQ, and excluding the fixed income securities.

#Equally Weighted Portfolio


```{r Equal Weights, echo=FALSE}
# Now simulate many different possible scenarios  
initial_wealth = 100000
simequal = foreach(i=1:5000, .combine='rbind') %do% {
  total_wealth = initial_wealth
  weights = c(0.2, 0.2, 0.2, 0.2, 0.2)
  holdings = weights * total_wealth
  n_days = 20
  wealthtracker = rep(0, n_days)
  for(today in 1:n_days) {
    return.today = resample(all_returns, 1, orig.ids=FALSE)
    holdings = holdings + holdings*return.today
    total_wealth = sum(holdings)
    wealthtracker[today] = total_wealth
  }
  wealthtracker
}
#Ending wealth
hist(simequal[,n_days], 30, xlab = 'Portfolio Value After 4 Weeks', main = 'Equally Weighted Portfolio', col='lightblue')
endingequal = mean(simequal[,n_days])
simulations[1,1] = endingequal
# cat('Average wealth after 4 weeks: $', endingequal, sep='')

# Profit/loss
hist(simequal[,n_days]- initial_wealth, breaks=30, xlab='Gain/Loss in 4 weeks', main = 'Equally Weighted Portfolio - Profit', col='lightblue')
# Calculate 5% value at risk
varequal = quantile(simequal[,n_days], 0.05) - initial_wealth
simulations[2,1] = varequal
# cat('5% Value at Risk: $', abs(varequal), sep='')

```


<br>

#Safe Portfolio


```{r Safe, echo=FALSE}
# Now simulate many different possible scenarios  
initial_wealth = 100000
simsafe = foreach(i=1:5000, .combine='rbind') %do% {
  total_wealth = initial_wealth
  weights = c(0.2, 0.4, 0.4, 0.0, 0.0)
  holdings = weights * total_wealth
  n_days = 20
  wealthtracker = rep(0, n_days)
  for(today in 1:n_days) {
    return.today = resample(all_returns, 1, orig.ids=FALSE)
    holdings = holdings + holdings*return.today
    total_wealth = sum(holdings)
    wealthtracker[today] = total_wealth
  }
  wealthtracker
}
#Ending wealth
hist(simsafe[,n_days], 30, xlab = 'Portfolio Value After 4 Weeks', main = 'Safe Portfolio', col='lightgreen')
endingsafe = mean(simsafe[,n_days])
simulations[1,2] = endingsafe
#cat('Average wealth after 4 weeks: $', endingsafe, sep='')

# Profit/loss
hist(simsafe[,n_days]- initial_wealth, breaks=30, xlab='Gain/Loss in 4 weeks', main = 'Safe Portfolio - Profit', col='lightgreen')
# Calculate 5% value at risk
varsafe =  quantile(simsafe[,n_days], 0.05) - initial_wealth
simulations[2,2] = varsafe
#cat('5% Value at Risk: $', abs(varsafe), sep='')

```





<br>

#Aggressive Portfolio


```{r Risky, echo=FALSE}
# Now simulate many different possible scenarios  
initial_wealth = 100000
simrisky = foreach(i=1:5000, .combine='rbind') %do% {
  total_wealth = initial_wealth
  weights = c(0.4, 0.0, 0.0, 0.5, 0.1)
  holdings = weights * total_wealth
  n_days = 20
  wealthtracker = rep(0, n_days)
  for(today in 1:n_days) {
    return.today = resample(all_returns, 1, orig.ids=FALSE)
    holdings = holdings + holdings*return.today
    total_wealth = sum(holdings)
    wealthtracker[today] = total_wealth
  }
  wealthtracker
}
#Ending wealth
hist(simrisky[,n_days], 25, xlab = 'Portfolio Value After 4 Weeks', main = 'Aggressive Portfolio',  col=rgb(1,0,0,1/2))
endingrisky = mean(simrisky[,n_days])
simulations[1,3] = endingrisky
# cat('Average wealth after 4 weeks: $', endingrisky, sep='')

# Profit/loss
hist(simrisky[,n_days]- initial_wealth, breaks=30, xlab='Gain/Loss in 4 weeks', main = 'Aggressive Portfolio - Profit', col=rgb(1,0,0,1/2))
# Calculate 5% value at risk
varrisky = quantile(simrisky[,n_days], 0.05) - initial_wealth
simulations[2,3] = varrisky
# cat('5% Value at Risk: $', abs(varrisky), sep='')
```


```{r Comparison, echo=FALSE}
plot(density(simsafe[,n_days]), xlim = c(70000,200000), col = 'green', main='Portfolio Values', xlab='$ value after 4 weeks', ylab='Frequency', lwd=3)
lines(density(simequal[,n_days]), col = 'blue', lwd=3)
lines(density(simrisky[,n_days]), col = 'red', lwd=3)
legend('right',legend=c('Safe','Equal','Aggressive'),fill=c('green','blue','red'))

kable(as.table(simulations)) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

##Analysis

The table above shows the simulated expected return and 5% Value at Risk for the three portfolios. Value at Risk (VaR) represents the dollar value loss associated with the worst 5% possible outcomes. As expected, the safer distribution of assets primarily into fixed income securities reduced the VaR of the portfolio by nearly 50% compared to the equally weighted portfolio. However, the expected profit was also reduce by almost 50%. In contrast, the aggressive portfolio that excluded fixed income securities nearly doubled the VaR and simulated profit. The density plot above even shows the possibility for the agrressive portfolio to double in value over just the four-week timespan.

As an investor, your choice should be made depending on your risk tolerance and time horizon. A longer time frame can make use of the aggressive portfolio to achieve heigher expected returns and weather out the large variations. A shorter time frame can utilize the safer portfolio to secure a low VaR while receiving some gains.







